<!DOCTYPE html>
<html ng-app="IntelRssReader">
<head>
	<title>Intel UI challenge</title>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css">	
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.1/css/material-wfont.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.1/css/ripples.min.css">
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-sanitize.min.js"></script>
	<style type="text/css">
		
		#side-nav #subscribe{
			text-align: center;
		}
		.well{
			min-height: 100%;
		}
		.list-group .list-group-item {
			background-color: transparent;
			overflow: hidden;
			border: 0;
			border-radius: 0;
			padding: 8px 16px;
		}
		#side-nav .side-list i{
			margin-right: 10px;
		}
		#side-nav .side-list li.list-group-item:hover {
			background: rgba(0,0,0,0.1);
			cursor: pointer;
		}
		.btn-group{
		 box-shadow: none; 
		}
		.btn-group:hover{
		 box-shadow: 0 3px 10px rgba(0,0,0,.23),0 3px 10px rgba(0,0,0,.16); 
		}
		#main-container .feed-list .well{
			box-shadow: 0 0px 0px rgba(0,0,0,.23),0 1px 10px rgba(0,0,0,.16);
		}
		#main-container .feed-list .well span.label.label-primary {
			padding: 3px 40px;
		}
		#main-container .feed-list .well h3{
			padding-top: 0px;
			margin-top: 0px;
		}
		span.btn.btn-default.content-link {
			margin-top: 15px;
		}
		span.btn.btn-default a{
			text-decoration: none;
		}
		span.btn.btn-default a:hover{
			text-decoration: none;
		}
		span.btn.btn-default a:active{
			text-decoration: none;
		}
		span.btn.btn-default a:focus{
			text-decoration: none;
		}
		.modal#subscribe{
			text-align: center;
		}
		span.col-xs-12.content.ng-binding {
			padding: 20px;
		}
		.content img {
			max-width: 100%;
			height: auto;
		}
		#side-nav .well{
			width: 30%;
			position: fixed;
		}
	</style>
</head>
<body>
	<!-- Modal -->
<div class="modal fade" id="subscribe" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Add Url</h4>

      </div>
      <div class="modal-body" ng-controller="modalController">
      	<div class="row">
	        <div class="col-xs-6 col-xs-offset-3">
	        	<div class="form-group">
	        		<input type="text" class="form-control" placeholder="Add Url Here" ng-model="newSubscription">
	        	</div>
	        	<div class="form-group">
	        		<button class="btn btn-primary" ng-click="subscribe()">Subcribe</button>
	        	</div>
	        </div>
    	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
	<div class="col-xs-4" id="side-nav" ng-controller="navController">
		<div class="well">
			<div class="form-group" id="subscribe">
				<button class="btn btn-primary"  data-toggle="modal" data-target="#subscribe">Add a subscription &nbsp;&nbsp;<i class="glyphicon glyphicon-plus-sign"> </i></button>
			</div>
			<div class="side-list">
				<ul class="list-group">
				  <li class="list-group-item" ng-click="showHome()">
				  	<i class="glyphicon glyphicon-home"> </i>
				    Home
				  </li>
				  <li class="list-group-item">
				  	<i class="glyphicon glyphicon-th-list" ng-click="showHome()"> </i>
				    All Items
				  </li>
				  <li class="list-group-item" ng-click="showStarred()">
				    <span class="badge">{{starredCount}}</span>
				  	<i class="glyphicon glyphicon-star"> </i>
				    Starred
				  </li>
				  <li class="list-group-item" ng-click="showLiked()">
				    <span class="badge">{{likedCount}}</span>
				  	<i class="glyphicon glyphicon-heart"> </i>
				    Liked
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-share-alt"> </i>
				    Shared
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-bookmark"> </i>
				    Bookmarked
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-signal"> </i>
				    Trending
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-menu-down"> </i>
				    Following
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-th-list"> </i>
				    Egor Harnakov
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-user"> </i>
				    Subscription
				  </li>
				  <li class="list-group-item">
				    <span class="badge">14</span>
				  	<i class="glyphicon glyphicon-tower"> </i>
				    Hacker News
				  </li>
				</ul>
			</div>
		</div>
	</div>
	<div class="col-xs-8" id="main-container" ng-controller="ListController">
		<div class="well">
			<h2>All Items</h2>
			<hr>
			<div class="btn-group">
				<a href="javascript:void(0)" class="btn btn-default">Mark All as unread</a>
				<a href="javascript:void(0)" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
				<ul class="dropdown-menu">
					<li><a href="javascript:void(0)">Action</a></li>
					<li><a href="javascript:void(0)">Another action</a></li>
					<li><a href="javascript:void(0)">Something else here</a></li>
					<li class="divider"></li>
					<li><a href="javascript:void(0)">Separated link</a></li>
				</ul>
			</div>
			<div class="feed-list">
				<div class="allLists" ng-hide="single">
					<div ng-repeat="feeds in feedArray">
						<div class="well" ng-repeat="feed in feeds" data-map="{{$parent.$index}}-{{$index}}">
							<h3><a href="{{feed.link}}" target="_blank">{{feed.title}}</a></h3>
							<span class="label label-primary">Hacker News</span><br>
							<span ng-bind-html="feed.content" class="col-xs-12 content"></span>
							<br>
							<button class="btn btn-default btn-raised" ng-click="addToStar(feed)"> <i class="glyphicon glyphicon-star"> </i> Star</button>
							<button class="btn btn-default btn-raised" ng-click="toggleRead(feed)"> <i class="glyphicon glyphicon-check"> </i> Mark as unread</button>
							<button class="btn btn-default btn-raised" ng-click="sendTo(feed)"> <i class="glyphicon glyphicon-arrow-right"> </i> send to</button>
							<button class="btn btn-default btn-raised" ng-click="share(feed)"> <i class="glyphicon glyphicon-share"> </i> share</button>
							<button class="btn btn-default btn-raised" ng-click="toggleLike(feed)"> <i class="glyphicon glyphicon-heart"> </i> like</button>
						</div>
					</div>
				</div>
				<div class="singleList" ng-show="single">
					<div class="well" ng-repeat="feed in singleListFeeds" data-map="{{$parent.$index}}-{{$index}}">
						<h3><a href="{{feed.link}}" target="_blank">{{feed.title}}</a></h3>
						<span class="label label-primary">Hacker News</span><br>
						<span ng-bind-html="feed.content" class="col-xs-12 content"></span>
						<br>
						<button class="btn btn-default btn-raised" ng-click="addToStar(feed)"> <i class="glyphicon glyphicon-star"> </i> Star</button>
						<button class="btn btn-default btn-raised" ng-click="toggleRead(feed)"> <i class="glyphicon glyphicon-check"> </i> Mark as unread</button>
						<button class="btn btn-default btn-raised" ng-click="sendTo(feed)"> <i class="glyphicon glyphicon-arrow-right"> </i> send to</button>
						<button class="btn btn-default btn-raised" ng-click="share(feed)"> <i class="glyphicon glyphicon-share"> </i> share</button>
						<button class="btn btn-default btn-raised" ng-click="toggleLike(feed)"> <i class="glyphicon glyphicon-heart"> </i> like</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="https:////cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.1/js/material.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.1/js/ripples.min.js"></script>
	<script type="text/javascript">
	$.material.init();
	</script>
	<script type="text/javascript">
	var app = angular.module('IntelRssReader', ['ngSanitize']);
    app.run(function($rootScope){
    	$rootScope.feedUrls = [];
    	$rootScope.feedArray = [];
    	$rootScope.allFeeds = [];
    	$rootScope.starredList = [];
    	$rootScope.readList = [];
    	$rootScope.likedList = [];
    	$rootScope.starredCount = 0;
    	$rootScope.likedCount = 0;
    	$rootScope.readCount = 0;
    	$rootScope.single = false;
    	$rootScope.singleListFeeds = [];
    });
	app.factory('FeedService', ['$http', '$rootScope', function ($http, $rootScope) { 
	    var functions = {
		             parseFeed: function (url) {
			          	return $http.jsonp('http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=JSON_CALLBACK&q='+url);
	               	 },
	               	 addUrl: function(url){
	               	 	var flag = false;
	               	 	angular.forEach($rootScope.feedUrls, function(link){
							console.log('inside vala' + link);
							if(url == link)
								flag = true;
							else
								flag = false;
						});
						if(!flag){
	               	 		$rootScope.feedUrls.push(url);
						}
	               	 	console.log($rootScope.feedUrls);
	               	 	functions.populateFeeds();
	               	 	functions.allFeeds();
	               	 },
	               	 populateFeeds: function(){
	               	 	var parsef = function(url){
							functions.parseFeed(url)
							.then(function(res){
								$rootScope.feedArray.push(res.data.responseData.feed.entries);
								$('#subscribe').modal('toggle');
								console.log($rootScope.feedArray);
							});
						}
						$rootScope.feedArray = [];
						angular.forEach($rootScope.feedUrls, function(url){
							parsef(url);
						});
	               	 },
	               	 allFeeds: function(){
	               	 	angular.forEach($rootScope.feedArray, function(array){
	               	 		console.log(array);
	               	 	})
	               	 }
	            } 
	              
            return functions;
    }]); 
	app.controller('ListController', ['$scope', '$http', 'FeedService', '$rootScope',  function ($scope, $http, Feed, $rootScope) {
		$scope.addToStar = function(feed){
			$rootScope.starredList.push(feed);
			console.log($rootScope.starredList);
	    	$rootScope.starredCount += 1;
		}
		$scope.toggleRead = function(feed){
			$rootScope.readList.push(feed);
			console.log($rootScope.readList);
	    	$rootScope.readCount += 1;
		}
		$scope.toggleLike = function(feed){
			$rootScope.likedList.push(feed);
			console.log($rootScope.likedList);
	    	$rootScope.likedCount += 1;
		}
	}]);
	app.controller('navController', ['$scope', '$rootScope', function($scope, $rootScope){
		console.log($scope);
		$scope.showLiked = function(){
			$rootScope.singleListFeeds = $rootScope.likedList;
			$rootScope.single = true;
		};
		$scope.showStarred = function(){
			$rootScope.singleListFeeds = $rootScope.starredList;
			$rootScope.single = true;
		};
		$scope.showHome = function(){
			$rootScope.single = false;
		}
	}]);
	app.controller('modalController', ['$scope', 'FeedService', function ($scope, Feed) {
		Feed.addUrl('http://blog.hackerearth.com/feed');
		$scope.subscribe = function(){
			Feed.addUrl($scope.newSubscription);
		}
	}])
	</script>
</body>
</html>